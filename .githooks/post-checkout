#!/bin/bash
#
# Post-checkout hook for Orca project
# Auto-updates Archon task status when switching to feature branches
#

PREV_HEAD=$1
NEW_HEAD=$2
BRANCH_CHECKOUT=$3

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# Only process branch checkouts (not file checkouts)
if [ "$BRANCH_CHECKOUT" != "1" ]; then
    exit 0
fi

# Get new branch name
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "")

# Extract TASK-XXX from branch name
if [[ "$BRANCH_NAME" =~ (feature|fix|refactor|hotfix)/TASK-([0-9]{3}) ]]; then
    TASK_ID="TASK-${BASH_REMATCH[2]}"

    echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo -e "${GREEN}✓ Switched to branch with $TASK_ID${NC}"
    echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo ""
    echo -e "${YELLOW}📋 Task Information:${NC}"
    echo -e "   Task ID: $TASK_ID"
    echo -e "   Branch: $BRANCH_NAME"
    echo ""

    # Note: Actual Archon MCP integration would go here
    # For now, we provide manual instructions
    echo -e "${YELLOW}🔔 Next Steps:${NC}"
    echo -e "   1. Check task status: Use Archon MCP to view task details"
    echo -e "   2. Update to 'doing': If starting work on this task"
    echo -e "   3. Research task requirements before coding"
    echo ""
    echo -e "${YELLOW}💡 Quick Commands:${NC}"
    echo -e "   Ctrl+Shift+G U → Update task status (VSCode)"
    echo -e "   Ctrl+Shift+G T → View task details (VSCode)"
    echo ""
    echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

    # Future: Auto-update Archon task status via MCP
    # This would require:
    # - Claude MCP CLI tool or API access
    # - mcp__archon__manage_task integration
    # - Error handling for offline/unavailable Archon server
    #
    # Example pseudo-code:
    # if command -v claude >/dev/null 2>&1; then
    #     claude mcp archon manage_task update --task-id "$TASK_ID" --status doing
    # fi
fi

exit 0
